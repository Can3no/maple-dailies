<app-container>
  <div class="mb-5 flex justify-between items-center flex-col md:flex-row">
    <span
      class="font-light mb-3 md:mb-0 whitespace-nowrap overflow-hidden overflow-ellipsis"
    >
      <span class="hidden md:inline-block">Dailies reset in</span>
      {{ remainingTime !== null ? remainingTime : "..." }}
    </span>
    <div class="flex justify-center items-center space-x-2">
      <app-button color="success" (click)="openAddNewDailyListModal()">
        <fa-icon class="mr-1" [icon]="addIcon"></fa-icon>
        <span>Add New List</span>
      </app-button>
      <app-button
        color="outline"
        (click)="toggleListLayout()"
        title="Change to the {{
          columnLayoutSelected ? 'grid' : 'list'
        }} layout"
      >
        <fa-icon
          [icon]="columnLayoutSelected ? gridLayoutIcon : columnLayoutIcon"
        >
        </fa-icon>
      </app-button>
    </div>
  </div>

  <div
    [ngClass]="{
      'w-full h-full flex flex-col items-center space-y-4': columnLayoutSelected,
      'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 items-start gap-4': !columnLayoutSelected
    }"
  >
    <div
      *ngFor="let list of dailiesLists"
      class="w-full"
      [ngClass]="{ 'md:w-2/3': columnLayoutSelected }"
    >
      <app-daily-list
        [listId]="list.dailyListId"
        [listTitle]="list.title"
        [dailies]="list.dailies"
        [systemList]="list.systemFlag"
        (addDaily)="onAddDaily($event)"
        (editDaily)="onEditDaily($event)"
        (deleteList)="onDeleteDailyList($event)"
        (toggleCompletion)="onToggleDailyCompletion($event)"
        (toggleAllCompletion)="onToggleAllDailiesCompletion($event)"
        (toggleVisibility)="onToggleDailyVisibilty($event)"
      ></app-daily-list>
    </div>
  </div>
</app-container>

<!-- Add New List Modal -->
<app-modal
  headerTitle="Add a New List"
  [id]="addNewDailyListModalId"
  (close)="resetAll()"
  #addNewDailyListModal
>
  <form
    *ngIf="dailyListTitleForm"
    [formGroup]="dailyListTitleForm"
    class="grid grid-cols-1 gap-6 mb-2"
    (submit)="dailyListTitleForm?.valid && addNewDailyList()"
  >
    <label class="block">
      <span>List Name</span>
      <input
        type="text"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-black focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
        formControlName="title"
      />
    </label>
  </form>
  <div class="flex justify-end space-x-3" footer-content>
    <app-button
      color="success"
      (click)="addNewDailyList()"
      [disabled]="dailyListTitleForm?.invalid || false"
      >Save</app-button
    >
    <app-button
      color="secondary"
      (click)="resetAll(); addNewDailyListModal.closeModal()"
      >Cancel</app-button
    >
  </div>
</app-modal>

<!-- Add/Edit Daily Modal -->
<app-modal
  headerTitle="{{ isEditingDaily ? 'Edit' : 'Add' }} Daily"
  [id]="addEditDailyModalId"
  (close)="resetAll()"
  #addNewDailyModal
>
  <form
    *ngIf="dailyTextForm"
    [formGroup]="dailyTextForm"
    class="grid grid-cols-1 gap-6"
    (ngSubmit)="dailyTextForm?.valid && saveDailyToList(isEditingDaily)"
  >
    <label class="block">
      <input
        type="text"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-black focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
        formControlName="daily"
      />
    </label>
  </form>
  <div class="flex justify-end space-x-3" footer-content>
    <app-button
      color="success"
      [disabled]="dailyTextForm?.invalid || false"
      (click)="saveDailyToList(isEditingDaily)"
      >Save</app-button
    >
    <app-button
      color="secondary"
      (click)="resetAll(); addNewDailyModal.closeModal()"
      >Cancel</app-button
    >
  </div>
</app-modal>

<!-- Delete Daily List Modal -->
<app-modal
  headerTitle="Delete {{ seletedListTitle }}"
  [id]="deleteDailyListModalId"
  (close)="resetAll()"
  #deleteDailyListModal
>
  <div class="flex justify-center">
    Are you sure you want to delete {{ seletedListTitle }}?
  </div>
  <div class="flex justify-end space-x-3" footer-content>
    <app-button color="success" (click)="confirmDeleteDailyList()"
      >Confirm</app-button
    >
    <app-button
      color="secondary"
      (click)="resetAll(); deleteDailyListModal.closeModal()"
      >Cancel</app-button
    >
  </div>
</app-modal>
